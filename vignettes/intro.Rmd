---
title: "Introduction to the PGCA Package"
author: "Mandeep Sasaki, Gabriela Cohen Freue, David Kepplinger"
date: "March 31, 2017"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Introduction}
output:
    knitr:::html_vignette:
        df_print: kable
        toc: true
        number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo=TRUE
)
options(width=120)
```
# Introduction
Protein Group Code Algorithm (PGCA) is an algorithm to link groups from multiple
experimental runs by forming global protein groups from connected local groups.
The algorithm is computationally inexpensive and enables the connection and
analysis of lists of protein groups across runs needed in biomarkers studies.

# Installation
The package can be easily installed from Bioconductor using the commands
```{r, eval=FALSE}
## try http:// if https:// URLs are not supported
source("https://bioconductor.org/biocLite.R")
biocLite("pgca")
```

In the remainder of this documnet we will briefly go over the main functions,
see the basic operations and have a look at the outputs. Additional options
are listed at the end and additional parameters for these functions are
available in the help files.

First, we load the `pgca` package:
```{r}
library(pgca)
```

We load a set of data created beforehand for illustration. Users can either load
their own data or use those saved in the workspace.
```{r}
acc1947 <- read.delim(system.file("extdata", "accs_no_1947.txt", package="pgca"))
acc2007 <- read.delim(system.file("extdata", "accs_no_2007.txt", package="pgca"))
acc2047 <- read.delim(system.file("extdata", "accs_no_2047.txt", package="pgca"))
acc2067 <- read.delim(system.file("extdata", "accs_no_2067.txt", package="pgca"))
```
The command loads 4 example MS/MS data sets `acc1947, acc2007, acc2047, acc2067`
from this saved R data archive.

[Back to Top](#TOC)

# Build Dictionary
We build a dictionary for protein groups from 3 of the MS/MS data files. We will
use acc2007, acc2047, and acc2067 as examples.
```{r}
head(acc2007)
head(acc2047)
```
In these 2 files of MS/MS data, protein pilot has chosen different protein
identifiers for the protein with the Gene Symbol FGG. In _acc2007_ the
identifier Accession ID is 'IPI00877703.1' and the local group identifier is 14.
```{r}
subset(acc2007, Gene_Symbol == 'FGG')
```

In acc2047 protein pilot has chosen the same protein as the identifer, but
a different local group. The group comprises 4 proteins. The protein identified
by Accession ID 'IPI00877703.1' is also dectected in acc2067, however it is not
selected as the top protein.
```{r}
subset(acc2047, Gene_Symbol == 'FGG')
subset(acc2067, Gene_Symbol == 'FGG')
```

The pre-loaded data can be used as input if `pgcaDict()` is used. Since the
data contains a column for the gene symbols, we may want to retain it by
specifying the `col.mapping` argument.
```{r}
dict <- pgcaDict(
    acc2007,
    acc2047,
    acc2067,
    col.mapping=c(gene.symbol="Gene_Symbol")
)

```

In the resulting dictionary, FGG has now been assigned to protein group 14
which contains all IPI accession ids from all the files included in the
dictionary build, and all three local groups.

```{r}
subset(dict$dictionary, gene == 'FGG')
```

[Back to Top](#TOC)

# Translation
Now we have a mapping of protein group codes needed to translate our MS/MS
files. We use the `applyDict` function to apply the protein group codes to
our data files to convert the data files and ensure they contain comparable
groups for use in downstream analyses. In this example we input our pre-loaded
data frames and do not specify an output directory to get the results as
a list of data frames.

```{r}
translated <- applyDict(acc2007, acc2067, dict=dict)
```

In the translated data files, a protein group code ('PGC') column is appended.
We see that PGC 14 is used for FGG in both data files.
```{r}
subset(translated$acc2007, Gene_Symbol == "FGG")
subset(translated$acc2067, Gene_Symbol == "FGG")
```

[Back to Top](#TOC)

# Appendix
## A larger example
Now we use 4 MS/MS files to build our dictionary. We can again use the
`pgcaDict()` function to read the data directly from the files.
The files contain the gene symbol in the column `"Gene_Symbol"` and we want to
retain it.
```{r}
dict2 <- pgcaDict(
    system.file("extdata", "accs_no_1947.txt", package="pgca"),
    system.file("extdata", "accs_no_2007.txt", package="pgca"),
    system.file("extdata", "accs_no_2047.txt", package="pgca"),
    system.file("extdata", "accs_no_2067.txt", package="pgca"),
    col.mapping=c(gene.symbol="Gene_Symbol")
)
```

These four files are all in the same directory. Since they are the only files in
this directory, we can use the function `pgcaDict()` to create the same
dictionary as above:
```{r}
dict2 <- pgcaDict(
    system.file("extdata", package="pgca"),
    col.mapping=c(gene.symbol="Gene_Symbol")
)
```

The resulting protein group code for FGG is now 10.
```{r}
subset(dict2$dictionary, gene == "FGG")
```
With the addition of new files and the resulting new dictionary, all MS/MS files
require another translation.
```{r}
translated2 <- applyDict(acc2007, acc2067, acc2047, acc1947,
                         dict=dict2, out.dir=NULL)
```
Re-translation of the files using the updated dictionary, provides updated
protein groups for the MS/MS data
```{r}
subset(translated2[[1]], Gene_Symbol == 'FGG')
subset(translated2[[2]], Gene_Symbol == 'FGG')
```

## Additional Functions
We save the dictionary we just generated to a tab separated (default) text file

```{r}
dictOutFile <- tempfile()
saveDict(dict, file=dictOutFile)
```

[Back to Top](#TOC)
