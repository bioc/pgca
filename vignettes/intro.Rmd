---
title: "Introduction to the PGCA Package"
author: AUTHOR_XXX
date: "`r Sys.Date()`"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Introduction}
output:
    knitr:::html_vignette:
        df_print: kable
        toc: true
        number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    echo = TRUE
)
options(width = 120)
```
# Introduction
Protein Group Code Algorithm (PGCA) is an algorithm to link groups from multiple
experimental runs by forming global protein groups from connected local groups.
The algorithm is computationally inexpensive and enables the connection and
analysis of lists of protein groups across runs needed in biomarkers studies.

# Installation

Like many other R packages, the simplest way to obtain `PGCA` is to install it
directly from CRAN. Type the following command in R console:

```{r, eval=FALSE}
install.packages("pgca", repos = "http://cran.us.r-project.org")
```

In the remainder of this documnet we will briefly go over the main functions,
see the basic operations and have a look at the outputs. Additional options
are listed at the end and additional parameters for these functions are
available in the help files.

First, we load the `pgca` package:
```{r}
library(pgca)
```

We load a set of data created beforehand for illustration. Users can either load
their own data or use those saved in the workspace. 
```{r}
acc1947 <- read.delim(system.file("extdata", "accs_no_1947.txt", package = "pgca"))
acc2007 <- read.delim(system.file("extdata", "accs_no_2007.txt", package = "pgca"))
acc2047 <- read.delim(system.file("extdata", "accs_no_2047.txt", package = "pgca"))
acc2067 <- read.delim(system.file("extdata", "accs_no_2067.txt", package = "pgca"))
```
The command loads 4 example MS/MS data sets `acc1947, acc2007, acc2047, acc2067`
from this saved R data archive. 

[Back to Top](#TOC)

# Dictionary Build
We build a dictionary for protein groups from 3 of the MS/MS data files. We will
use acc1947, acc2007, and acc2067 as examples.
```{r}
head(acc2007)
head(acc2067)
```
In these 2 files of MS/MS data, protein pilot has chosen different protein
identifiers for the protein with the Gene Symbol IGHD. In acc2007 the identifier
Accession ID is 'IPI00418422.3' and the local group identifier is 115. This
group comprises only a single protein.
```{r}
subset(acc2007, Gene_Symbol == 'IGHD')
```

In acc2067 protein pilot has chosen  a different protein as the identifer. The
protein identifier has accession ID 'IPI00163446.3' and local group ID 106, and
the group comprises three proteins. 
```{r}
subset(acc2067, Gene_Symbol == 'IGHD')
```

The pre-loaded data can be used as input if `pgca.data()` is used. Since the
data contains a column for the gene symbols, we may want to retain it by
specifying the `col.mapping` argument.
```{r}
dict <- pgca.data(
    acc2007,
    acc2067,
    col.mapping = c(gene.symbol = "Gene_Symbol")
)

```

In the resulting dictionary, IGHD has now been assigned to protein group 115
which contains all IPI accession ids from all files included in the dictionary
build, and both local groups 106 and 115. 

```{r}
subset(dict$dictionary, gene == 'IGHD')
```

Now we have a mapping of protein group codes needed to translate our MS/MS
files. We use the `translate` function to apply the protein group codes to
our data files to convert the data files and ensure they contain comparable
groups for use in downstream analyses. In this example we input our pre-loaded
data frames as a list of data frames and also return a translated list of data
frames

[Back to Top](#TOC)

# Translation 
```{r}
translated <- translate(dict, input = list(acc2007, acc2067), out.dir = NULL)
```

In the translated data files, a protein group code ('PGC') column is appended.
We see that PGC 10 is used for FGG in both data files. 
```{r}
subset(translated[[1]], PGC == 115)
subset(translated[[2]], PGC == 115)
```

[Back to Top](#TOC)

# Appendix
## A larger example
Now we use 4 MS/MS files to build our dictionary. We can use the `pgca.files()`
function to read the data directly from the files. The files contain the gene
symbol in the column `"Gene_Symbol"` and we want to retain it.
```{r}
dict2 <- pgca.files(
    system.file("extdata", "accs_no_1947.txt", package = "pgca"),
    system.file("extdata", "accs_no_2007.txt", package = "pgca"),
    system.file("extdata", "accs_no_2047.txt", package = "pgca"),
    system.file("extdata", "accs_no_2067.txt", package = "pgca"),
    col.mapping = c(gene.symbol = "Gene_Symbol")
)
```

These four files are all in the same directory. Since they are the only files in
this directory, we can use the function `pgca()` to create the same dictionary
as above:
```{r}
dict2 <- pgca(
    system.file("extdata", package = "pgca"),
    col.mapping = c(gene.symbol = "Gene_Symbol")
)
```

The resulting protein group code for IGHD is now 111 and consists of a much
larger protein group. 
```{r}
subset(dict2$dictionary, pg == 111)
```
With the addition of new files and the resulting new dictionary, all MS/MS files
require another translation. 
```{r}
translated2 <- translate(dict2, input = list(acc2007, acc2067, acc2047,
acc1947), out.dir = NULL)
```
Re-translation of the files using the updated dictionary, provides updated
protein groups for the MS/MS data
```{r}
subset(translated2[[1]], Gene_Symbol == 'IGHD')
subset(translated2[[2]], Gene_Symbol == 'IGHD')
```

## Additional Functions
We save the dictionary we just generated to a tab separated (default) text file

```{r, eval=FALSE}
save.dict(dict, file = "dictionary.txt")
```

[Back to Top](#TOC)